# Adapt Package - Структурный адаптер и генератор YAML

Этот пакет предоставляет функционал для адаптации структур на основе структурных тегов и генерации YAML файлов с комментариями из них.

## Основной функционал

### Функция `AdaptStruct`

Основная функция пакета, которая применяет правила, описанные в структурных тегах, к полям входной структуры.

```go
func AdaptStruct(input any) (any, error)
```

**Параметры:**
- `input` - указатель или значение структуры для адаптации

**Возвращает:**
- `any` - отредактированная копия структуры
- `error` - ошибка, если входной параметр не является структурой

**Пример использования:**

```go
type User struct {
    Age     int    `rst-min:"18" rst-max:"120"`
    Email   string `rst-regex:"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"`
    Status  string `rst-choice:"active||inactive||pending"`
}

user := User{
    Age:    15,  // Будет изменено на 18 (минимальное значение)
    Email:  "john.doe@example.com",  // Останется без изменений (соответствует regex)
    Status: "unknown",  // Будет изменено на "active" (первое допустимое значение)
}

adapted, err := AdaptStruct(user)
if err != nil {
    log.Fatal(err)
}
```

## Поддерживаемые теги

### RST теги (Runtime Structure Tags)

Пакет поддерживает следующие теги для адаптации структур:

#### `rst-min` - Минимальное значение
Устанавливает минимальное значение для числовых полей.

```go
type Example struct {
    Count int `rst-min:"5"`  // Если Count < 5, будет установлено 5
    Price float64 `rst-min:"10.5"`  // Если Price < 10.5, будет установлено 10.5
}
```

#### `rst-max` - Максимальное значение
Устанавливает максимальное значение для числовых полей.

```go
type Example struct {
    Count int `rst-max:"100"`  // Если Count > 100, будет установлено 100
    Price float64 `rst-max:"10.5"`  // Если Price > 10.5, будет установлено 10.5
}
```

#### `rst-default` - Значение по умолчанию
Устанавливает значение по умолчанию для полей (включая nil-указатели).

```go
type Example struct {
    Name string `rst-default:"Unknown"`
    Age  int    `rst-default:"25"`
    Active bool `rst-default:"true"`
}
```

#### `rst-choice` - Допустимые значения
Ограничивает поле определенным набором значений. При значении, не входящем в набор, подставляется первое из перечисленных.

```go
type Example struct {
    Status string `rst-choice:"active||inactive||pending"`  // Только эти значения
    Type   int    `rst-choice:"1||2||3"`  // Только 1, 2 или 3
}
```

#### `rst-forbidden` - Запрещенные значения
Запрещает конкретные значения и указывает подменное значение с помощью разделителя `**`.

Формат: `value1||value2||...**replacement`

```go
type Example struct {
    ID int `rst-forbidden:"0||1||2**10"`     // 0,1,2 заменяются на 10
    Value float64 `rst-forbidden:"-1.0||0.0**-10.0"` // -1.0 или 0.0 заменяются на -10.0
}
```

#### `rst-regex` - Регулярное выражение
Применяет регулярное выражение к строковым полям (удаляет все, кроме совпадения).

```go
type Example struct {
    Email string `rst-regex:"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"`
    Phone string `rst-regex:"^\\+?[1-9]\\d{1,14}$"`
}
```

### Дополнительные теги

#### `info` - Описание поля
Используется для генерации комментариев в YAML файлах.

```go
type Example struct {
    Name string `info:"Имя пользователя"`
    Age  int    `info:"Возраст пользователя"`
}
```

#### `json` - JSON теги
Поддерживаются стандартные JSON теги для именования полей.

```go
type Example struct {
    UserName string `json:"user_name"`
    UserAge  int    `json:"user_age,omitempty"`
}
```

## YAML генератор

### Функция `GenerateStructYAML`

Генерирует YAML представление структуры с комментариями из структурных тегов. 
- Списки выводятся в стандартном виде `- item`.
- Ключи `map` сортируются по алфавиту для стабильного результата.

```go
func GenerateStructYAML(input any) (string, error)
```

**Пример:**

```go
type Config struct {
    Server struct {
        Host string `json:"host" rst-default:"localhost" info:"Хост сервера"`
        Port int    `json:"port" rst-min:"4000" rst-max:"4010" rst-default:"4002" info:"Порт сервера"`
    } `json:"server" info:"Настройки сервера"`
}

config := Config{}
yaml, err := GenerateStructYAML(config)
if err != nil {
    log.Fatal(err)
}

err = os.WriteFile("myFile.yaml", []byte(yaml), 0644)
if err != nil {
	log.Fatal(err)
}
```

Пример результата (содержимое файла `myFile.yaml`):

```yaml
# Настройки сервера
  server:
# Хост сервера; значение по умолчанию - localhost
    host: ""
# Порт сервера; минимальное значение - 4000; максимальное значение - 4010; значение по умолчанию - 4002
    port: 0
```

## Особенности работы

### Рекурсивная обработка
Функции обрабатывают вложенные структуры, слайсы, карты и указатели рекурсивно.

### Обработка nil значений
- Nil указатели обрабатываются корректно
- Для nil указателей применяются только `rst-default` теги
- В YAML nil значения отображаются как `null`

### Пропуск неэкспортируемых полей
Поля, начинающиеся с маленькой буквы, автоматически пропускаются при генерации YAML.

### Поддержка JSON тегов
При генерации YAML используются имена полей из `json` тегов, если они указаны.

## Ограничения

1. Только экспортируемые поля — неэкспортируемые поля пропускаются при генерации YAML
2. Поддержка типов — не все типы данных поддерживаются всеми тегами
3. Производительность — рефлексия может влиять на производительность для больших структур
4. Валидация — пакет фокусируется на адаптации, а не на валидации данных

## Ошибки

Основные ошибки, которые может возвращать пакет:

- `ErrNotStruct` — входной параметр не является структурой
- `ErrInvalidTags` — некорректные теги в структуре (с указанием поля и тега) 